/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ (() => {

eval("/*********************************************************\r\n * index.js\r\n * Renders the chat widget in a Shadow DOM at #chat-widget-container\r\n *********************************************************/\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initializeChatWidget);\r\n} else {\r\n  initializeChatWidget();\r\n}\r\n\r\nasync function initializeChatWidget() {\r\n  const container = document.getElementById('chat-widget-container');\r\n  if (!container) {\r\n    console.error('Chat widget container not found');\r\n    return;\r\n  }\r\n\r\n  if (container.parentElement !== document.body) {\r\n    document.body.appendChild(container);\r\n  }\r\n\r\n  container.style.position = 'relative';\r\n  container.style.zIndex  = '2147483647';\r\n\r\n  const botId = container.getAttribute('data-user-id');\r\n  if (!botId) {\r\n    console.error('User ID not found (data-user-id is missing)');\r\n    return;\r\n  }\r\n\r\n  const shadowRoot = container.attachShadow({ mode: 'open' });\r\n\r\n  if (!document.getElementById('saicf-global-scroll-style')) {\r\n    const globalScrollStyle = document.createElement('style');\r\n    globalScrollStyle.id = 'saicf-global-scroll-style';\r\n    globalScrollStyle.textContent = `\r\n      body.no-scroll,\r\n      html.no-scroll {\r\n        overflow: hidden !important;\r\n        position: fixed !important;\r\n        inset: 0 !important;\r\n        width: 100% !important;\r\n        touch-action: none !important;\r\n        overscroll-behavior: none !important;\r\n      }\r\n    `;\r\n    document.head.appendChild(globalScrollStyle);\r\n  }\r\n\r\n  const styleTag = document.createElement('style');\r\n  styleTag.textContent = `\r\n    /**********************************************************\r\n     * Embedded widget.css (now isolated to this Shadow DOM)\r\n     **********************************************************/\r\n    :host, .saicf-chat-window, .saicf-chat-window * {\r\n      font-family: \"DM Sans\", sans-serif !important;\r\n    }\r\n\r\n    :host {\r\n      --widget-size: 80px; /* fallback â€“ will be overwritten by JS */\r\n    }\r\n\r\n    .saicf-chat-window p {\r\n      line-height: 1.3 !important;\r\n      font-size: 15px !important;\r\n    }\r\n    .saicf-chat-widget-icon {\r\n      position: fixed;\r\n      bottom: 20px;\r\n      right: 20px;\r\n      color: white;\r\n      border-radius: 50%;\r\n      width: 100px;\r\n      height: 100px;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      cursor: pointer;\r\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\r\n      font-size: 36px;\r\n      z-index: 999998 !important;\r\n    }\r\n    @keyframes pulse {\r\n      0% { transform: scale(1); }\r\n      50% { transform: scale(1.1); }\r\n      100% { transform: scale(1); }\r\n    }\r\n    .pulsing {\r\n      animation: pulse 2s infinite;\r\n    }\r\n    .saicf-chat-title {\r\n      font-size: 15px;\r\n      font-weight: 600;\r\n    }\r\n    .saicf-chat-window {\r\n      position: fixed;\r\n      bottom: 12px;\r\n      right: 12px;\r\n      width: 400px;\r\n      height: 550px;\r\n      background-color: transparent;\r\n      border: none;\r\n      border-radius: 16px;\r\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\r\n      display: flex !important;\r\n      flex-direction: column;\r\n      z-index: 2147483647 !important;\r\n      opacity: 0;\r\n      transform: translateY(100%);\r\n      transition: opacity 0.5s ease, transform 0.5s ease;\r\n    }\r\n    .saicf-chat-window.show {\r\n      opacity: 1;\r\n      transform: translateY(0);\r\n    }\r\n    .hidden {\r\n      display: none;\r\n    }\r\n    .saicf-chat-header {\r\n      color: white;\r\n      padding: 10px 15px;\r\n      border-radius: 16px 16px 0px 0px;\r\n      display: flex;\r\n      flex-direction: column;\r\n    }\r\n    .saicf-chat-header-title {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n    }\r\n    .saicf-logo-message-container {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    .saicf-close-btn {\r\n      background: none;\r\n      border: none;\r\n      color: rgb(218, 43, 43);\r\n      margin: 0;\r\n      padding: 0;\r\n      outline: none;\r\n      cursor: pointer;\r\n    }\r\n    .saicf-close-chat-widget-icon {\r\n      font-size: 20px;\r\n      font-weight: 600;\r\n      cursor: pointer;\r\n      transition: opacity 0.3s ease, transform 0.3s ease;\r\n    }\r\n    .saicf-close-chat-widget-icon:hover {\r\n      transform: scale(1.2);\r\n    }\r\n    .saicf-chat-body {\r\n      flex: 1;\r\n      padding: 8px;\r\n      padding-top: 0;\r\n      overflow-y: auto;\r\n      display: flex;\r\n      flex-direction: column;\r\n      background-color: white;\r\n    }\r\n    .saicf-chat-footer {\r\n      display: flex;\r\n      flex-direction: column;\r\n      padding: 10px;\r\n      background-color: white;\r\n      gap: 8px;\r\n    }\r\n    .saicf-powered-by {\r\n      display: flex;\r\n      justify-content: center;\r\n    }\r\n    .saicf-powered-by-text {\r\n      font-size: 10px;\r\n      color: rgb(146, 146, 146);\r\n      cursor: pointer;\r\n      text-decoration: underline;\r\n    }\r\n    .saicf-input-send-container {\r\n      display: flex;\r\n      border-top: 1px solid #ccc;\r\n      padding-top: 10px;\r\n    }\r\n    .saicf-chat-footer input {\r\n      flex: 1 !important;\r\n      padding: 7px !important;\r\n      border: 1px solid #ccc !important;\r\n      border-radius: 8px !important;\r\n      outline: none !important;\r\n      font-size: 16px !important;\r\n    }\r\n    .saicf-chat-footer button {\r\n      display: flex;\r\n      align-items: center;\r\n      margin-left: 6px;\r\n      padding-left: 15px;\r\n      padding-right: 15px;\r\n      color: white;\r\n      border: none;\r\n      border-radius: 10px;\r\n      cursor: pointer;\r\n      transition: background-color 0.4s ease, transform 0.2s ease;\r\n    }\r\n    .saicf-chat-footer button:hover {\r\n      background-color: #0595d3;\r\n      transform: translateY(-1.5px);\r\n    }\r\n    .saicf-widget-message {\r\n      max-width: 80%;\r\n      margin: 5px 0;\r\n      padding: 5px;\r\n      border-radius: 10px;\r\n      display: inline-block;\r\n    }\r\n    .widget-user-message {\r\n      align-self: flex-end !important;\r\n      color: white !important;\r\n      border-radius: 8px !important;\r\n      padding: 8px !important;\r\n      font-size: 15px !important;\r\n    }\r\n    .widget-bot-message {\r\n      align-self: flex-start !important;\r\n      background-color: #ffffff !important;\r\n      color: rgb(43, 43, 43) !important;\r\n      border-radius: 8px;\r\n      font-size: 15px !important;\r\n    }\r\n    .widget-bot-message strong {\r\n      color: rgb(57, 57, 57);\r\n    }\r\n    .widget-bot-message ul li:not(:last-child) {\r\n      margin-bottom: 6px;\r\n    }\r\n    .widget-user-message > :first-child,\r\n    .widget-bot-message > :first-child {\r\n      margin: 0;\r\n    }\r\n    .widget-user-message > :last-child,\r\n    .widget-bot-message > :last-child {\r\n      margin: 0;\r\n    }\r\n    .saicf-widget-send-icon {\r\n      font-size: 18px;\r\n      font-style: normal;\r\n    }\r\n    .saicf-loading-dots {\r\n      display: flex;\r\n      justify-content: left;\r\n      align-items: center;\r\n      height: 40px;\r\n      margin-top: 10px;\r\n      margin-bottom: 5px;\r\n    }\r\n    .saicf-loading-dots div {\r\n      width: 8px;\r\n      height: 8px;\r\n      margin: 0 4px;\r\n      border-radius: 50%;\r\n      animation: loading 0.6s infinite alternate;\r\n    }\r\n    @keyframes loading {\r\n      to {\r\n        opacity: 0.3;\r\n        transform: translateY(-8px);\r\n      }\r\n    }\r\n    .saicf-loading-dots div:nth-child(2) {\r\n      animation-delay: 0.2s;\r\n    }\r\n    .saicf-loading-dots div:nth-child(3) {\r\n      animation-delay: 0.4s;\r\n    }\r\n    .saicf-chat-widget-icon.align-left {\r\n      left: 25px !important;\r\n      right: auto !important;\r\n    }\r\n    .saicf-chat-widget-icon.elevated {\r\n      bottom: 55px !important;\r\n    }\r\n    .saicf-chat-window.align-left {\r\n      left: 20px !important;\r\n      right: auto !important;\r\n    }\r\n    .saicf-chat-window.elevated {\r\n      bottom: 12px !important;\r\n    }\r\n    .saicf-widget-message table {\r\n      border-collapse: separate;\r\n      border-spacing: 0px;\r\n      margin-top: 15px;\r\n      margin-bottom: 15px;\r\n      width: 100%;\r\n      overflow: auto;\r\n    }\r\n    .saicf-widget-message th, .saicf-widget-message td {\r\n      border: 1px solid rgba(0, 0, 0, 0.08);\r\n      padding: .35rem .50rem;\r\n      text-align: left;\r\n      font-size: 14px;\r\n    }\r\n    .saicf-widget-message th {\r\n      color: #000000;\r\n      background-color: rgba(0, 0, 0, 0.06);\r\n      border-right: 0;\r\n      padding: .5rem .50rem;\r\n      border-bottom: none;\r\n    }\r\n    .saicf-widget-message th:last-child {\r\n      border-right: 1px solid rgba(0, 0, 0, 0.08);\r\n    }\r\n    .saicf-widget-message td {\r\n      border-bottom: 0px solid rgba(0, 0, 0, 0.08);\r\n      border-right: 0px solid rgba(0, 0, 0, 0.08);\r\n    }\r\n    .saicf-widget-message td:last-child {\r\n      border-right: 1px solid rgba(0, 0, 0, 0.08);\r\n    }\r\n    .saicf-widget-message tr:first-child th:first-child {\r\n      border-top-left-radius: 8px;\r\n    }\r\n    .saicf-widget-message tr:first-child th:last-child {\r\n      border-top-right-radius: 8px;\r\n    }\r\n    .saicf-widget-message tr:last-child td:first-child {\r\n      border-bottom-left-radius: 8px;\r\n    }\r\n    .saicf-widget-message tr:last-child td:last-child {\r\n      border-bottom-right-radius: 8px;\r\n    }\r\n    .saicf-widget-message tr:last-child td {\r\n      border-bottom: 1px solid rgba(0, 0, 0, 0.08);\r\n    }\r\n\r\n    /**********************************************************\r\n     * Pop-up message styles\r\n     **********************************************************/\r\n    .saicf-pop-up-container {\r\n      position: fixed;\r\n      right: 20px;\r\n      bottom: calc(35px + var(--widget-size));\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 8px;\r\n      z-index: 999999;\r\n    }\r\n    .saicf-pop-up-container.align-left {\r\n      left: 25px !important;\r\n      right: auto !important;\r\n    }\r\n    .saicf-pop-up-message {\r\n      background: #ffffff;\r\n      padding: 12px 16px;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);\r\n      font-size: 15px;\r\n      color: #000000;\r\n      max-width: 300px;\r\n      line-height: 1.3;\r\n    }\r\n    .saicf-pop-up-close{\r\n      background:none;\r\n      border:none;\r\n      outline:none;\r\n      font-size:17px;\r\n      font-weight:500;\r\n      color:rgb(163,163,163);\r\n      align-self:flex-end;\r\n      cursor:pointer;\r\n      margin-top:-4px;\r\n      margin-bottom:0;\r\n      transform:scale(1);\r\n      transition:transform 0.5s ease;\r\n    }\r\n\r\n    .saicf-pop-up-close:hover{\r\n      transform:scale(1.08);\r\n    }\r\n\r\n    .saicf-pop-up-close{\r\n      opacity:0;\r\n      pointer-events:none;\r\n      transition:opacity .3s ease;\r\n    }\r\n    .saicf-pop-up-close.show{\r\n      opacity:1;\r\n      pointer-events:auto;\r\n    }\r\n\r\n    .saicf-pop-up-message{\r\n      opacity:0;\r\n      transform:translateY(6px);\r\n      transition:opacity .4s ease, transform .4s ease;\r\n    }\r\n    .saicf-pop-up-message.show{\r\n      opacity:1;\r\n      transform:translateY(0);\r\n    }\r\n\r\n    @media (max-width: 768px) {\r\n      .saicf-chat-overlay {\r\n        position: fixed;\r\n        background: rgba(0, 0, 0, 0.2);\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        z-index: 999999;\r\n      }\r\n      .saicf-chat-window {\r\n        position: fixed;\r\n        left: 4%;\r\n        bottom: 1%;\r\n        width: 92%;\r\n        height: 90%;\r\n        border-radius: 16px;\r\n        transition: opacity 0.6s ease, transform 0.6s ease;\r\n      }\r\n      body.no-scroll {\r\n        overflow: hidden;\r\n      }\r\n      .saicf-close-chat-widget-icon {\r\n        font-size: 22px;\r\n      }\r\n      .saicf-chat-title {\r\n        font-size: 16px;\r\n      }\r\n      .widget-user-message {\r\n        font-size: 17px;\r\n      }\r\n      .widget-bot-message {\r\n        font-size: 17px;\r\n      }\r\n      .saicf-chat-widget-icon {\r\n        width: 70px;\r\n        height: 70px;\r\n      }\r\n      .saicf-pop-up-container {\r\n        right: 20px;\r\n        bottom: calc(35px + var(--widget-size));\r\n      }\r\n      .saicf-pop-up-container.align-left {\r\n        left: 20px !important;\r\n        right: auto !important;\r\n      }\r\n    }\r\n  `;\r\n  shadowRoot.appendChild(styleTag);\r\n\r\n  const widgetRoot = document.createElement('div');\r\n  widgetRoot.id = 'widget-root';\r\n  shadowRoot.appendChild(widgetRoot);\r\n\r\n  if (typeof marked !== 'undefined') {\r\n    marked.setOptions({\r\n      gfm: true,\r\n      breaks: true,\r\n      headerIds: false,\r\n    });\r\n  }\r\n\r\n  function getBrowserLanguage() {\r\n    return navigator.language || navigator.userLanguage || 'en';\r\n  }\r\n  const browserLanguage = getBrowserLanguage();\r\n\r\n  let widgetConfig = {};\r\n  try {\r\n    const response = await fetch(`http://localhost:5000/api/widget_configuration/${botId}`);\r\n    widgetConfig = await response.json();\r\n  } catch (error) {\r\n    console.error('Error fetching widget configuration:', error);\r\n  }\r\n  console.log(widgetConfig.welcome_message)\r\n\r\n  const themeColor          = widgetConfig.theme_color             || '#0082ba';\r\n  const hoverColor          = widgetConfig.button_hover_color      || '#0595d3';\r\n  const headerFontColor     = widgetConfig.header_font_color       || '#ffffff';\r\n  const welcomeMessage      = widgetConfig.welcome_message;\r\n  const welcomeMessages     = widgetConfig.welcome_message\r\n            ? Array.isArray(widgetConfig.welcome_message)\r\n              ? widgetConfig.welcome_message\r\n              : [widgetConfig.welcome_message]\r\n            : [\"\"];\r\n  const widgetHeaderText    = widgetConfig.header_text             || 'Chat with us!';\r\n  const widgetBorderRadius  = widgetConfig.widget_border_radius    ?? 50;\r\n  const widgetSize          = widgetConfig.widget_size             ?? 75;\r\n  const logo                = widgetConfig.header_icon_path        || null;\r\n  const icon                = widgetConfig.widget_icon_path        || null;\r\n  const popUpDelaySeconds   = widgetConfig.pop_up_delay_seconds    ?? 2;\r\n\r\n  let isPulsing = false;\r\n  if (typeof widgetConfig.pulsing === 'boolean') {\r\n    isPulsing = widgetConfig.pulsing;\r\n  } else if (typeof widgetConfig.pulsing === 'string') {\r\n    isPulsing = widgetConfig.pulsing.toLowerCase() === 'true';\r\n  }\r\n\r\n  const horizontalAlignment = widgetConfig.widget_horizontal_alignment || 'right';\r\n  const verticalAlignment   = widgetConfig.widget_vertical_alignment   || 'bottom';\r\n\r\n  const chatWidgetIcon = document.createElement('div');\r\n  chatWidgetIcon.className = 'saicf-chat-widget-icon';\r\n  if (isPulsing) {\r\n    chatWidgetIcon.classList.add('pulsing');\r\n  }\r\n  if (!icon) {\r\n    chatWidgetIcon.style.backgroundColor = themeColor;\r\n    chatWidgetIcon.style.paddingBottom = '1px';\r\n  }\r\n  if (widgetBorderRadius != null) {\r\n    chatWidgetIcon.style.borderRadius = `${widgetBorderRadius}%`;\r\n  }\r\n  if (widgetSize != null) {\r\n    chatWidgetIcon.style.height = `${widgetSize}px`;\r\n    chatWidgetIcon.style.width = `${widgetSize}px`;\r\n\r\n    container.style.setProperty('--widget-size', `${widgetSize}px`);\r\n  }\r\n  if (icon) {\r\n    chatWidgetIcon.innerHTML = `\r\n      <img\r\n        src=\"${icon}\"\r\n        alt=\"Widget Icon\"\r\n        style=\"max-width: 100%; max-height: 100%; border-radius: ${widgetBorderRadius}%;\">\r\n    `;\r\n  } else {\r\n    chatWidgetIcon.innerHTML = ``;\r\n  }\r\n\r\n  const chatOverlay = document.createElement('div');\r\n  chatOverlay.className = 'saicf-chat-overlay hidden';\r\n\r\n  const chatWindow = document.createElement('div');\r\n  chatWindow.className = 'saicf-chat-window hidden';\r\n\r\n  const logoHTML = logo\r\n    ? `<img src=\"${logo}\" alt=\"Chat Logo\"\r\n         style=\"height:24px;width:24px;border-radius:50%;object-fit:cover;\"/>`\r\n    : '';\r\n  const headerHTML = `\r\n    <div class=\"saicf-chat-header\" style=\"background-color:${themeColor};\">\r\n      <div class=\"saicf-chat-header-title\">\r\n        <div class=\"saicf-logo-message-container\">\r\n          ${logoHTML}\r\n          <span class=\"saicf-chat-title\" style=\"color:${headerFontColor};\">${widgetHeaderText}</span>\r\n        </div>\r\n        <button class=\"saicf-close-btn saicf-close-chat-widget-icon\" style=\"color:${headerFontColor};\">\r\n          X\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n  chatWindow.innerHTML = `\r\n    ${headerHTML}\r\n    <div class=\"saicf-chat-body\"></div>\r\n    <div class=\"saicf-chat-footer\">\r\n      <div class=\"saicf-powered-by\">\r\n        <span class=\"saicf-powered-by-text\" onclick=\"window.open('http://ultimo-bots.com/', '_blank')\">\r\n          Powered by Ultimo Bots\r\n        </span>\r\n      </div>\r\n      <div class=\"saicf-input-send-container\">\r\n        <input type=\"text\" class=\"saicf-chat-input\" placeholder=\"Type your message...\">\r\n        <button class=\"saicf-send-message\" style=\"background-color:${themeColor};\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" style=\"width: 16px; height: 16px; fill: ${headerFontColor};\">\r\n            <path d=\"M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0L7 203.6c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 140.3V464c0 17.7 14.3 32 32 32s32-14.3 32-32V140.3l107.6 108.7c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L214.6 41.4z\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const popUpContainer = document.createElement('div');\r\n  popUpContainer.className = 'saicf-pop-up-container hidden';\r\n\r\n  const popUpCloseBtn = document.createElement('button');\r\n  popUpCloseBtn.className = 'saicf-pop-up-close';\r\n  popUpCloseBtn.textContent = 'X';\r\n  popUpContainer.appendChild(popUpCloseBtn);\r\n\r\n  welcomeMessages.forEach(msg => {\r\n    const msgEl = document.createElement('div');\r\n    msgEl.className = 'saicf-pop-up-message';\r\n    msgEl.textContent = msg;\r\n    popUpContainer.appendChild(msgEl);\r\n  });\r\n\r\n  widgetRoot.appendChild(chatWidgetIcon);\r\n  widgetRoot.appendChild(chatOverlay);\r\n  widgetRoot.appendChild(chatWindow);\r\n  widgetRoot.appendChild(popUpContainer);\r\n\r\n  if (horizontalAlignment === 'left') {\r\n    chatWidgetIcon.classList.add('align-left');\r\n    chatWindow.classList.add('align-left');\r\n    popUpContainer.classList.add('align-left');\r\n  }\r\n  if (verticalAlignment === 'elevated') {\r\n    chatWidgetIcon.classList.add('elevated');\r\n    chatWindow.classList.add('elevated');\r\n  }\r\n\r\n  const dynamicStyleEl = document.createElement('style');\r\n  dynamicStyleEl.textContent = `\r\n    .saicf-chat-footer button:hover {\r\n      background-color: ${hoverColor} !important;\r\n    }\r\n    .widget-user-message {\r\n      background-color: ${themeColor} !important;\r\n    }\r\n    .saicf-loading-dots div {\r\n      background-color: ${themeColor} !important;\r\n    }\r\n  `;\r\n  shadowRoot.appendChild(dynamicStyleEl);\r\n\r\n  const closeChatBtn   = chatWindow.querySelector('.saicf-close-btn');\r\n  const chatBody       = chatWindow.querySelector('.saicf-chat-body');\r\n  const chatInput      = chatWindow.querySelector('.saicf-chat-footer input');\r\n  const sendMessageBtn = chatWindow.querySelector('.saicf-send-message');\r\n\r\n  let sessionId = generateSessionId();\r\n  let widgetOpenedOnce = false;\r\n\r\n  chatWidgetIcon.addEventListener('click', () => {\r\n    chatWindow.classList.remove('hidden');\r\n    forceReflow(chatWindow);\r\n    chatWindow.classList.add('show');\r\n    chatOverlay.classList.remove('hidden');\r\n    if (window.matchMedia('(max-width: 768px)').matches) {\r\n      document.body.classList.add('no-scroll');\r\n    }\r\n    if (chatBody.childElementCount === 0) {\r\n      welcomeMessages.forEach(msg => {\r\n        appendMessage(msg, 'bot');\r\n      });\r\n    }\r\n    widgetOpenedOnce = true;\r\n    hidePopUp();\r\n  });\r\n\r\n  closeChatBtn.addEventListener('click', () => {\r\n    closeChat();\r\n  });\r\n\r\n  sendMessageBtn.addEventListener('click', () => {\r\n    sendMessage();\r\n  });\r\n\r\n  chatInput.addEventListener('keypress', (e) => {\r\n    if (e.key === 'Enter') {\r\n      sendMessage();\r\n    }\r\n  });\r\n\r\n  popUpCloseBtn.addEventListener('click', e => {\r\n    e.stopPropagation();\r\n    hidePopUp();\r\n    widgetOpenedOnce = true;\r\n  });\r\n\r\n  function showPopUpSequentially() {\r\n    if (widgetOpenedOnce) return;\r\n    popUpContainer.classList.remove('hidden');\r\n\r\n    const msgs = popUpContainer.querySelectorAll('.saicf-pop-up-message');\r\n    msgs.forEach((msg, i) => {\r\n      setTimeout(() => {\r\n        msg.classList.add('show');\r\n        if (i === 0) {\r\n          popUpCloseBtn.classList.add('show');\r\n        }\r\n      }, i * 1200);\r\n    });\r\n  }\r\n\r\n  function hidePopUp() {\r\n    popUpContainer.classList.add('hidden');\r\n    popUpContainer.querySelectorAll('.saicf-pop-up-message')\r\n                  .forEach(m => m.classList.remove('show'));\r\n    popUpCloseBtn.classList.remove('show');\r\n  }\r\n\r\n  setTimeout(showPopUpSequentially, popUpDelaySeconds * 1000);\r\n\r\n  function forceReflow(element) {\r\n    void element.offsetHeight;\r\n  }\r\n\r\n  function closeChat() {\r\n    chatWindow.classList.remove('show');\r\n    chatOverlay.classList.add('hidden');\r\n    if (window.matchMedia('(max-width: 768px)').matches) {\r\n      document.body.classList.remove('no-scroll');\r\n    }\r\n    setTimeout(() => chatWindow.classList.add('hidden'), 300);\r\n  }\r\n\r\n  function generateSessionId() {\r\n    const timestamp = new Date().getTime();\r\n    const randomNum = Math.floor(Math.random() * 10000) + 1;\r\n    return `${timestamp}-${randomNum}`;\r\n  }\r\n\r\n  async function sendMessage() {\r\n    const message = chatInput.value.trim();\r\n    if (!message) return;\r\n\r\n    appendMessage(message, 'user');\r\n    chatInput.value = '';\r\n    setLoading(true);\r\n\r\n    let currentBotMessage = '';\r\n    const maxRetries = 3;\r\n    let retryCount = 0;\r\n\r\n    const attemptConnection = () => {\r\n      return new Promise((resolve, reject) => {\r\n        const url = `https://portal.ultimo-bots.com/api/chatbot_response?user_input=${encodeURIComponent(message)}&session_id=${sessionId}&bot_id=${botId}&language=english`;\r\n        const eventSource = new EventSource(url);\r\n\r\n        let isFirstMessage = true;\r\n        let timeoutId;\r\n\r\n        eventSource.onmessage = (event) => {\r\n          const chunk = event.data;\r\n          if (chunk !== 'end of response') {\r\n            if (isFirstMessage) {\r\n              setLoading(false);\r\n              isFirstMessage = false;\r\n              clearTimeout(timeoutId);\r\n            }\r\n            const parsedChunk = chunk.replace(/<newline>/g, '\\n');\r\n            currentBotMessage += parsedChunk;\r\n            updateBotMessage(currentBotMessage);\r\n            scrollToBottom();\r\n          }\r\n        };\r\n\r\n        eventSource.onerror = (error) => {\r\n          if (isFirstMessage) {\r\n            reject(new Error('Failed to get response from server.'));\r\n          }\r\n          eventSource.close();\r\n        };\r\n\r\n        eventSource.addEventListener('end', () => {\r\n          updateBotMessage(currentBotMessage);\r\n          eventSource.close();\r\n          setLoading(false);\r\n          scrollToBottom();\r\n          resolve();\r\n        });\r\n\r\n        timeoutId = setTimeout(() => {\r\n          if (isFirstMessage) {\r\n            eventSource.close();\r\n            reject(new Error('No response received from server.'));\r\n          }\r\n        }, 8000);\r\n      });\r\n    };\r\n\r\n    const retryConnection = async () => {\r\n      while (retryCount < maxRetries) {\r\n        try {\r\n          await attemptConnection();\r\n          return;\r\n        } catch (error) {\r\n          retryCount++;\r\n          if (retryCount >= maxRetries) {\r\n            setLoading(false);\r\n            appendMessage(`Failed to get response after ${maxRetries} attempts.`, 'bot');\r\n            throw error;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    try {\r\n      await retryConnection();\r\n    } catch (error) {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function updateBotMessage(text) {\r\n    const lastMessage = chatBody.lastElementChild;\r\n    if (lastMessage && lastMessage.classList.contains('widget-bot-message')) {\r\n      if (typeof marked !== 'undefined') {\r\n        lastMessage.innerHTML = marked.parse(text);\r\n      } else {\r\n        lastMessage.textContent = text;\r\n      }\r\n    } else {\r\n      appendMessage(text, 'bot');\r\n    }\r\n  }\r\n\r\n  function appendMessage(text, sender) {\r\n    const messageElement = document.createElement('div');\r\n    messageElement.className = `saicf-widget-message widget-${sender}-message`;\r\n    if (typeof marked !== 'undefined') {\r\n      messageElement.innerHTML = marked.parse(text);\r\n    } else {\r\n      messageElement.textContent = text;\r\n    }\r\n    chatBody.appendChild(messageElement);\r\n    scrollToBottom();\r\n  }\r\n\r\n  function scrollToBottom() {\r\n    chatBody.scrollTop = chatBody.scrollHeight;\r\n  }\r\n\r\n  function setLoading(isLoading) {\r\n    if (isLoading) {\r\n      const loadingDots = document.createElement('div');\r\n      loadingDots.className = 'saicf-loading-dots';\r\n      loadingDots.innerHTML = '<div></div><div></div><div></div>';\r\n      chatBody.appendChild(loadingDots);\r\n      scrollToBottom();\r\n    } else {\r\n      const loadingDots = chatBody.querySelector('.saicf-loading-dots');\r\n      if (loadingDots) {\r\n        loadingDots.remove();\r\n      }\r\n    }\r\n  }\r\n}\r\n\n\n//# sourceURL=webpack://swiss_bot_widget/./src/index.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/index.js"]();
/******/ 	
/******/ })()
;